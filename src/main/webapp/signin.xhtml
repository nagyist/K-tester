<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<ui:composition template="template.xhtml">
    <ui:define name="content">

        <div id="header">
            <nav>
                <ul>
                    <li><a href="signin.xhtml">Sign in</a></li>
                    <li><a href="commands.xhtml">Commands</a></li>
                    <li><a href="http://developer.kontomatik.com/api-doc" target="_blank">Documentation</a></li>
                </ul>
            </nav>

            <div id="client" class="tooltip" onclick="redirect()">${resourcesBean.clientName}
                <span class="tooltiptext">Change client</span>
            </div>
            <br style="clear:both"/>
        </div>
        <div id="kontomatik">
        </div>
        <script type="text/javascript">
                //<![CDATA[
                embedKontomatik({
                    client: '#{resourcesBean.clientName}',
                    divId: 'kontomatik',
                    locale: 'en',
                    ownerExternalId: '#{resourcesBean.ownerExternalId}',
                    onSuccess: function (target, sessionId, sessionIdSignature) {
                        // Pass session params to the backend
                        $.ajax({
                            type: 'POST',
                            url: window.location.origin + '/${resourcesBean.contextRoot}/session',
                            data:
                            {
                            sessionId: sessionId,
                            sessionIdSignature: sessionIdSignature,
                            target: target,
                            },
                            dataType: 'text',
                            success: function (data, textStatus, jqXHR) {
                                 $("#controlPanel").css('visibility', 'visible');

                            },
                             error: function (jqXHR, textStatus, errorThrown) {
                                        alert(errorThrown);
                                    }
                             });
                    },
                    onError: function (exception) {
                        alert('A Kontomatik error has occurred: ' + exception);
                    }
                });
                //]]>
        </script>

        <div id="komands">
            <p style="text-align: left;"><strong>Call high-level API commands: </strong></p>
            <form action="results" method="post" class="userForm">
                <fieldset>
                    <input type="hidden" name="command" value="import-owners-details"/>
                    <button type="submit" class="sendButton">Import owners</button>
                </fieldset>
            </form>
            <form action="results" method="post" class="userForm">
                <fieldset>
                    <input type="hidden" name="command" value="import-accounts"/>
                    <button type="submit" class="sendButton">Import accounts</button>
                </fieldset>
            </form>
            <form action="results" method="post" class="userForm">
                <fieldset>
                    <input type="hidden" name="command" value="import-account-transactions"/>
                    Account IBAN: <input type="text" name="iban" required="true" autocomplete="off"/>
                    <br/><br/>
                    Since: <input type="date" name="since" required="true" placeholder="dd/mm/yyyy"/>
                    <br/><br/>
                    <button type="submit" class="sendButton">Import account transactions</button>
                </fieldset>
            </form>
            <form action="results" method="post" class="userForm">
                <fieldset>
                    <input type="hidden" name="command" value="default-import"/>
                    Since: <input type="date" name="since" required="true" placeholder="dd/mm/yyyy"/>
                    <br/><br/>
                    <button type="submit" class="sendButton">Default-import</button>
                </fieldset>
            </form>
            <form action="results" method="post" class="userForm">
                <fieldset>
                    <input type="hidden" name="command" value="aggregated-values"/>
                    <input type="hidden" name="ownerExternalId" value="${resourcesBean.ownerExternalId}"/>
                    Months: <input type="number" name="periodMonths" required="true"/>
                    <br/><br/>
                    <button type="submit" class="sendButton">Aggregated-values</button>
                </fieldset>
            </form>
            <form id="signOutForm" action="results" method="post" class="userForm" style="${sessionBean.formStyle}">
                <fieldset>
                    <input type="hidden" name="command" value="sign-out"/>
                    <button type="submit" class="sendButton">Sign-out</button>
                </fieldset>
            </form>

        </div>
    </ui:define>
</ui:composition>
</html>
