<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<ui:composition template="template.xhtml">
    <ui:define name="content">

        <header>
            <nav>
                <ul>
                    <li><a href="signin.xhtml">Reload</a></li>
                </ul>
            </nav>
            <div class="tooltip" onclick="redirect()">${resourcesBean.clientName}
                <span class="tooltiptext">Change client</span>
            </div>
            <br style="clear: both"/>
        </header>
        <section>
            <div class="widget">
                <div class="tooltip" style="float: left; margin-bottom: 20px;">
                    <div id="kontomatik"></div>
                    <span class="tooltiptext">Sign in to your bank</span>
                </div>
                <script type="text/javascript">
                            //<![CDATA[
                                embedKontomatik({
                                    client: '#{resourcesBean.clientName}',
                                    divId: 'kontomatik',
                                    locale: 'en',
                                    ownerExternalId: '#{resourcesBean.ownerExternalId}',
                                    onSuccess: function (target, sessionId, sessionIdSignature) {
                                    // Pass session params to the backend
                                        $.ajax({
                                            type: 'POST',
                                            url: window.location.origin + '/${resourcesBean.contextRoot}/session',
                                            data:
                                            {
                                            sessionId: sessionId,
                                            sessionIdSignature: sessionIdSignature,
                                            target: target,
                                            },
                                            dataType: 'text',
                                            success: function (data, textStatus, jqXHR) {
                                                $(":button").prop('disabled', false);
                                                $(":input").prop('disabled', false);
                                            },
                                            error: function (jqXHR, textStatus, errorThrown) {
                                                        alert(errorThrown);
                                            }
                                        });
                                    },
                                    onError: function (exception) {
                                        alert('A Kontomatik error has occurred: ' + exception);
                                    }
                                });
                            //]]>


                </script>
            </div>

            <div class="commands">
                <div class="tooltip" style="margin-top: 90px; margin-bottom: 20px;">
                    <form action="results" method="post" class="userForm">
                        <fieldset>
                            <input type="hidden" name="command" value="import-owners-details"/>
                            <button type="submit" disabled="disabled">Import owners</button>
                        </fieldset>
                    </form>
                    <form action="results" method="post" class="userForm">
                        <fieldset>
                            <input type="hidden" name="command" value="import-accounts" disabled="disabled"/>
                            <button type="submit" disabled="disabled">Import accounts</button>
                        </fieldset>
                    </form>
                    <form action="results" method="post" class="userForm">
                        <fieldset>
                            <input type="hidden" name="command" value="import-account-transactions"
                                   disabled="disabled"/>
                            Account IBAN: <input type="text" name="iban" required="true" autocomplete="off"
                                                 disabled="disabled"/>
                            <br/><br/>
                            Since: <input type="date" name="since" required="true" placeholder="dd/mm/yyyy"
                                          disabled="disabled"/>
                            <br/><br/>
                            <button type="submit" disabled="disabled">Import account transactions</button>
                        </fieldset>
                    </form>
                    <form action="results" method="post" class="userForm">
                        <fieldset>
                            <input type="hidden" name="command" value="default-import"/>
                            Since: <input type="date" name="since" required="true" placeholder="dd/mm/yyyy"
                                          disabled="disabled"/>
                            <br/><br/>
                            <button type="submit" disabled="disabled">Default-import</button>
                        </fieldset>
                    </form>
                    <form action="results" method="post" class="userForm">
                        <fieldset>
                            <input type="hidden" name="command" value="aggregated-values"/>
                            <input type="hidden" name="ownerExternalId"
                                   value="${resourcesBean.ownerExternalId}"/>
                            Months: <input type="number" name="periodMonths" required="true"
                                           disabled="disabled"/>
                            <br/><br/>
                            <button type="submit" disabled="disabled">Aggregated-values</button>
                        </fieldset>
                    </form>
                    <form id="signOutForm" action="results" method="post" class="userForm"
                          style="${sessionBean.formStyle}">
                        <fieldset>
                            <input type="hidden" name="command" value="sign-out"/>
                            <button type="submit" disabled="disabled">Sign-out</button>
                        </fieldset>
                    </form>
                    <span class="tooltiptext">Kontomatik API commands</span>
                </div>
            </div>
            <br style="clear:both"/>
        </section>
        <footer>
            <br/>
            <h2>K-tester</h2>
            <br/>
        </footer>
    </ui:define>
</ui:composition>
</html>
